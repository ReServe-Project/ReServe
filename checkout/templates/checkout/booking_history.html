{% extends 'base.html' %}
{% load static %}

{% block meta %}
    <title>Booking History</title>
    {# Link to a new CSS file we will create for this page #}
    <link rel="stylesheet" href="{% static 'css/history.css' %}">
{% endblock meta %}

{% block content %}
<div class="history-container">
    <div class="history-header">
        <a href="javascript:history.back()" class="back-button-circle">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </a>
        <h1>History</h1>
    </div>

    {# Display any success/error messages #}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div class="history-layout">
        <div class="main-column">
            {% for booking in bookings %}
                <div class="booking-card">
                    <div class="card-image">
                        {# --- FIX 1: Check the correct image field --- #}
                        {% if booking.class_booked.image_url %}
                            {# --- FIX 2: Use the correct image field and name field --- #}
                            <img src="{{ booking.class_booked.image_url }}" alt="{{ booking.class_booked.name }}">
                        {% else %}
                            <div class="image-placeholder"></div>
                        {% endif %}
                    </div>
                    <div class="card-title">
                        {# --- FIX 3: Use the correct name field --- #}
                        <h3>{{ booking.class_booked.name }}</h3>
                    </div>
                    <div class="card-details">
                        {# NOTE: Using the class date/time, not the booking date #}
                        <p>{{ booking.class_booked.datetime|date:"d F Y H.i" }}</p> {# Assuming the field is named datetime #}
                        <p>{{ booking.class_booked.location }}</p>
                    </div>
                    <div class="card-actions">
                        <form action="{% url 'checkout:delete_booking' booking.id %}" method="POST" onsubmit="return confirm('Are you sure you want to delete this booking?');">
                            {% csrf_token %}
                            <button type="submit" class="btn-delete">Delete</button>
                        </form>
                        {# The Edit button is just a placeholder for now #}
                        <button class="btn-edit">Edit</button>
                    </div>
                </div>
            {% empty %}
                <p>You have no booking history.</p>
            {% endfor %}
        </div>

        <div class="sidebar-column">
            <div class="explore-card">
                <img src="{% static 'images/track.png' %}" alt="Running Track">
                <h3>Check out more classes!</h3>
                <a href="{% url 'home_search:search' %}" class="btn-explore">Explore more</a>
            </div>
        </div>
    </div>
</div>
{% endblock content %}