{% extends 'base.html' %}
{% load static %}

{% block meta %}
    <title>Booking History</title>
    <link rel="stylesheet" href="{% static 'css/history.css' %}">
{% endblock meta %}

{% block content %}
<div class="history-container">
    <div class="history-header">
        <a href="javascript:history.back()" class="back-button-circle">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </a>
        <h1>History</h1>
    </div>

    {# Display any success/error messages #}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div class="history-layout">
        <div class="main-column">

            {# ----- START OF UPDATED LOOP STRUCTURE ----- #}
            {% for booking in bookings %}
                <div class="booking-card">
                    <div class="card-image">
                        {% if booking.class_booked.image_url %}
                            <img src="{{ booking.class_booked.image_url }}" alt="{{ booking.class_booked.name }}">
                        {% else %}
                            <div class="image-placeholder">No Image</div> {# Placeholder text #}
                        {% endif %}
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">{{ booking.class_booked.name }}</h3>
                    </div>
                    <div class="card-info-actions">
                         <div class="card-details">
                            <p class="card-date">{{ booking.class_booked.datetime|date:"d F Y H.i" }}</p>
                            <p class="card-location">{{ booking.class_booked.location }}</p>
                        </div>
                        <div class="card-actions">
                            <form action="{% url 'checkout:delete_booking' booking.id %}" method="POST" onsubmit="return confirm('Are you sure you want to delete this booking?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-delete">Delete</button> {# Added btn class #}
                            </form>
                            {# Add specific class for Edit button styling #}
                            <button class="btn btn-edit">Edit</button> {# Added btn class #}
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>You have no booking history.</p>
            {% endfor %}
            {# ----- END OF UPDATED LOOP STRUCTURE ----- #}

        </div>

        <div class="sidebar-column">
            <div class="explore-card">
                <img src="{% static 'images/track.png' %}" alt="Running Track">
                <h3>Check out more classes!</h3>
                <a href="{% url 'home_search:search' %}" class="btn-explore">Explore more</a>
            </div>
        </div>
    </div>
</div>
{% endblock content %}